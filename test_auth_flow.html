<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Flow Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Authentication Flow Test</h1>
    
    <div class="test-section">
        <h2>Session Management Test</h2>
        <button onclick="testSessionInit()">Test Session Initialization</button>
        <button onclick="testAuthState()">Test Auth State</button>
        <button onclick="clearSession()">Clear Session</button>
        <div id="session-results"></div>
    </div>

    <div class="test-section">
        <h2>Expected Flow</h2>
        <ol>
            <li><strong>Fresh Browser Visit:</strong> Should redirect to /login</li>
            <li><strong>Login Page:</strong> Should clear any existing auth and initialize session</li>
            <li><strong>Successful Login:</strong> Should redirect to /dashboard</li>
            <li><strong>Navigation:</strong> Should work normally within session</li>
            <li><strong>Browser Close/Reopen:</strong> Should require fresh login</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        function testSessionInit() {
            const sessionInit = sessionStorage.getItem('solar_session_initialized');
            const authState = sessionStorage.getItem('solar_auth_state');
            const userData = sessionStorage.getItem('solar_current_user');
            
            log(`Session Initialized: ${sessionInit}`, sessionInit ? 'success' : 'error');
            log(`Auth State: ${authState ? 'Present' : 'Not Present'}`, authState ? 'info' : 'error');
            log(`User Data: ${userData ? 'Present' : 'Not Present'}`, userData ? 'info' : 'error');
            
            document.getElementById('session-results').innerHTML = `
                <p><strong>Session Init:</strong> ${sessionInit || 'Not Set'}</p>
                <p><strong>Auth State:</strong> ${authState || 'Not Set'}</p>
                <p><strong>User Data:</strong> ${userData || 'Not Set'}</p>
            `;
        }

        function testAuthState() {
            try {
                const authState = sessionStorage.getItem('solar_auth_state');
                if (authState) {
                    const parsed = JSON.parse(authState);
                    log(`Auth State: ${JSON.stringify(parsed)}`, 'info');
                } else {
                    log('No auth state found', 'error');
                }
            } catch (error) {
                log(`Error parsing auth state: ${error.message}`, 'error');
            }
        }

        function clearSession() {
            sessionStorage.removeItem('solar_session_initialized');
            sessionStorage.removeItem('solar_auth_state');
            sessionStorage.removeItem('solar_current_user');
            localStorage.removeItem('solar_auth_state');
            localStorage.removeItem('solar_current_user');
            log('Session cleared', 'success');
            testSessionInit();
        }

        // Auto-test on page load
        window.onload = function() {
            log('Testing authentication flow...', 'info');
            testSessionInit();
        };
    </script>
</body>
</html>
